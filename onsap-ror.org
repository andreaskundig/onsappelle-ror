#+title: Onsap Ror
[[file:/mnt/c/Users/andre/workspace/onsappelle/onsappelle.org::][spec...]]

* turbo_frames

/reminders/17 -> reminders/show.html.erb
[[file:app/views/reminders/show.html.erb::<h3>Recipients][adding recipient]] to reminder
#+begin_src erb
    <%= link_to "[+]", new_reminder_user_path(@reminder),
     data: {turbo_frame: 'new_user'}%>
#+end_src
reminders/show.html.erb has [[file:app/views/reminders/show.html.erb::<%= link_to "\[+\]", new_reminder_user_path(@reminder),][[+] link]] to add recipients
which goes to new_reminder_user_path
which is configured in [[file:config/routes.rb::resources :users do][routes.rb]]
to go first to users_controller.rb [[file:app/controllers/users_controller.rb::def new][new]]
which responds with template [[file:app/views/users/new.html.erb::<%= turbo_frame_tag "new_user" do %>][new.html.erb]]
which has a turbo frame with a form that triggers
users_controller.rb [[file:app/controllers/users_controller.rb::def create][create]]
which adds a user to the reminder and saves it
and responds with create.turbo_stream.erb
which [[file:app/views/users/create.turbo_stream.erb::partial: "users/user",][returns]] html generated from [[file:app/views/users/_user.html.erb::<%= turbo_frame_tag user do %>][_user.html.erb]]
and causes turbo to
- prepend the generated user html to the user list
- delete the user adding form

every user on reminders/show.html.erb has a [[file:app/views/users/_user.html.erb::<%= link_to '\[-\]',][[-] link]]
which goes to remove_reminder_user_path
which is configured in [[file:config/routes.rb::delete 'remove', to: 'reminders#remove_user'][routes.rb]]
to trigger reminders_controller.rb [[file:app/controllers/reminders_controller.rb::def remove_user][remove_user]]
which deletes the relation in the db
and returns [[file:app/views/reminders/remove_user.turbo_stream.erb::<%= turbo_stream.remove @user %>][remove_user.turbo_stream.erb]]
which causes turbo to remove that user's turbo_frame
which reminders/show.html.erb got from [[file:app/views/users/_user.html.erb::<%= turbo_frame_tag user do %>][users/_user.html.rb]]

* TODO navigation: reminder creation paths

** /reminders/new
- date input
- existing emails (own?)  [remove] -> create -> edit
- email input [add]] -> create  -> edit

[save] -> create (status :active) -> show

currently
date, create reminders -> Reminder.new(date)



** /reminders/edit/:id

same form as for creation


** /reminders/show/:id

- date
- existing emails

[update]



* TODO rename reminder.users to .recipients
* TODO send emails at reminder date
* TODO refactor: remove unused routes controller methods
* TODO [[https://github.com/paper-trail-gem/paper_trail][paper_trail]] for reminders and  user_reminders
* TODO passwordless authentication by email
gem
https://github.com/mikker/passwordless

handrolled
https://blog.testdouble.com/posts/2022-10-25-building-passwordless-email-auth-in-rails/
with token
https://dev.to/phawk/password-less-auth-in-rails-4ah

* steps

[[https://guides.rubyonrails.org/association_basics.html#choosing-between-has-many-through-and-has-and-belongs-to-many][has-many :through relation]]
#+begin_src bash

$ rails new onsappelle-ror
$ cd onsappelle-ror

$ bin/rails generate model User email:string
$ bin/rails generate model Reminder date:datetime
$ bin/rails generate model UserReminder user:references reminder:references

$ bin/rails db:migrate

$ bin/rails generate controller Reminders index
$ bin/rails generate controller Users
#+end_src

* language server: solargraph
https://emacs-lsp.github.io/lsp-mode/page/lsp-solargraph/
https://github.com/castwide/solargraph
https://github.com/iftheshoefritz/solargraph-rails/
#+begin_src bash
gem install solargraph
gem install solargraph-rails
#+end_src
